# WhatsApp ‚Üí Telegram bridge

Flask‚Äë—Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∞–µ—Ç –≤–µ–±—Ö—É–∫–∏ WhatsApp Business Cloud API –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π —á–∞—Ç Telegram.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
WA_TOKEN=—Ç–æ–∫–µ–Ω_whatsapp_cloud_api
WA_PHONE_NUMBER_ID=ID_—Ä–∞–±–æ—á–µ–≥–æ_–Ω–æ–º–µ—Ä–∞_–∏–∑_—Ä–∞–∑–¥–µ–ª–∞_WhatsApp
WA_VERIFY_TOKEN=–ª—é–±–æ–π_—Å–µ–∫—Ä–µ—Ç_–¥–ª—è_–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏_–≤–µ–±—Ö—É–∫–∞
TELEGRAM_BOT_TOKEN=—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–∏–∑_botfather
TELEGRAM_CHAT_ID=id_—á–∞—Ç–∞_–∫—É–¥–∞_—Å–ª–∞—Ç—å
TELEGRAM_NOTIFY_CHAT_ID=id_–≥—Ä—É–ø–ø—ã_–¥–ª—è_—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
OPENROUTER_API_KEY=–∫–ª—é—á_–∏–∑_openrouter
OPENROUTER_MODEL=minimax/minimax-m2:free
ENABLE_AI_AUTOREPLY=true
```

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ) –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

- `OPENROUTER_SYSTEM_PROMPT` ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤.
- `OPENROUTER_REFERRER` –∏ `OPENROUTER_TITLE` ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ OpenRouter –ø—Ä–æ—Å–∏—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö.
- `PORT` ‚Äî –ø–æ—Ä—Ç Flask‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- `ENABLE_AI_AUTOREPLY` –≤–ª–∏—è–µ—Ç –∏ –Ω–∞ –≤–µ–±—Ö—É–∫‚Äë—Å–µ—Ä–≤–∏—Å, –∏ –Ω–∞ Telegram‚Äë–ª–∏–¥‚Äë–±–æ—Ç–∞.

> `WA_PHONE_NUMBER_ID` –±–µ—Ä—ë—Ç—Å—è –≤ Meta ‚Üí WhatsApp ‚Üí **API Setup** ‚Üí **From** ‚Üí **Phone number ID**. –û–Ω –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ Cloud API.

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### 1. –°–æ–∑–¥–∞—ë–º Telegram‚Äë–±–æ—Ç–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram ‚Üí –Ω–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `@BotFather`.
2. –ö–æ–º–∞–Ω–¥–∞ `/newbot`, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è –∏ —é–∑–µ—Ä–Ω–µ–π–º (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `bot`).
3. BotFather –≤—ã–¥–∞—Å—Ç `TELEGRAM_BOT_TOKEN`. –°—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –≤ `.env`.

### 2. –ü–æ–ª—É—á–∞–µ–º `TELEGRAM_CHAT_ID`
1. –í Telegram –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–≤–æ–µ–≥–æ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ `Start` (–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ).
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –∞–¥—Ä–µ—Å—É `https://api.telegram.org/bot<–í–ê–®_–¢–û–ö–ï–ù>/getUpdates`.
3. –í JSON‚Äë–æ—Ç–≤–µ—Ç–µ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–æ –±–ª–æ–∫–∞ `result[0].message.chat.id` (–∏–ª–∏ `message.chat.id`) ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å `TELEGRAM_CHAT_ID`. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —á–∏—Å–ª–æ –≤ `.env`.

### 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º WhatsApp Business Cloud API
1. –ó–∞–π–¥–∏—Ç–µ –≤ [Meta for Developers](https://developers.facebook.com/) –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
2. –°–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **WhatsApp** ‚Üí **API Setup** (–∏–ª–∏ **Configuration**).
3. –í –±–ª–æ–∫–µ **Webhook** –Ω–∞–∂–º–∏—Ç–µ **Edit** –∏ —É–∫–∞–∂–∏—Ç–µ:
   - URL: `https://<–≤–∞—à-–¥–æ–º–µ–Ω –∏–ª–∏ —Ç—É–Ω–Ω–µ–ª—å>/webhook`
   - Verify Token: —Å—Ç—Ä–æ–∫–∞ `WA_VERIFY_TOKEN` –∏–∑ `.env`.
4. –ù–∞–∂–º–∏—Ç–µ **Verify and Save** ‚Äî Meta –æ—Ç–ø—Ä–∞–≤–∏—Ç `GET` –∑–∞–ø—Ä–æ—Å, —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å challenge (—ç—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ).
5. –ù–∏–∂–µ –≤ —Ä–∞–∑–¥–µ–ª–µ **Webhooks fields** –Ω–∞–∂–º–∏—Ç–µ **Manage** –∏ –≤–∫–ª—é—á–∏—Ç–µ —Ö–æ—Ç—è –±—ã –ø–æ–ª–µ **messages**.
6. –í —Ä–∞–∑–¥–µ–ª–µ **Permanent token** —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ `WA_TOKEN` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `.env`.
7. –í —ç—Ç–æ–º –∂–µ —Ä–∞–∑–¥–µ–ª–µ —Å—Ä–∞–∑—É –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ `Phone number ID` ‚Äî —ç—Ç–æ `WA_PHONE_NUMBER_ID`.

### 4. –ü–æ–¥–∫–ª—é—á–∞–µ–º OpenRouter (LLM)
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [openrouter.ai](https://openrouter.ai/), —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∏ –≤—ã–ø—É—Å—Ç–∏—Ç–µ API key.
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á –≤ `.env` –∫–∞–∫ `OPENROUTER_API_KEY`.
3. –ó–Ω–∞—á–µ–Ω–∏–µ `OPENROUTER_MODEL` –æ—Å—Ç–∞–≤—å—Ç–µ `minimax/minimax-m2:free` ‚Äî –∏–º–µ–Ω–Ω–æ —ç—Ç—É –º–æ–¥–µ–ª—å –Ω—É–∂–Ω–æ –¥–µ—Ä–≥–∞—Ç—å.
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å—Ç–µ `OPENROUTER_SYSTEM_PROMPT`, —á—Ç–æ–±—ã –∑–∞–¥–∞—Ç—å —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–¢—ã –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –æ—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é.¬ª).

### 5. –ì–æ—Ç–æ–≤–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

### 6. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å
```bash
python app.py
```
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `8000` (`PORT` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å). –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–¥–Ω–∏–º–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å:
```bash
# –ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ ngrok
ngrok http 8000
```
URL –∏–∑ ngrok –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é webhook (—Å–º. —à–∞–≥ 3).

### 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º
1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–æ–º–µ—Ä WhatsApp –≤ Meta Sandbox –∏–ª–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.
2. –í –ª–æ–≥–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É–≤–∏–¥–∏—Ç–µ –≤—Ö–æ–¥—è—â–∏–π payload.
3. –í Telegram‚Äë—á–∞—Ç–µ –ø–æ—è–≤–∏—Ç—Å—è:
   - –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞;
   - –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `ü§ñ –û—Ç–≤–µ—Ç...` —Å —Ç–µ–º, —á—Ç–æ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª –∫–ª–∏–µ–Ω—Ç—É.
4. –ö–ª–∏–µ–Ω—Ç –≤ WhatsApp —É–≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ LLM.

---

# Telegram Lead Bot

–§–∞–π–ª `telegram_bot.py` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –±–æ—Ç –æ–±—â–∞–µ—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º –Ω–∞–ø—Ä—è–º—É—é –≤ Telegram, —Å–æ–±–∏—Ä–∞–µ—Ç –∏–º—è/—Ç–µ–ª–µ—Ñ–æ–Ω/–∑–∞–ø—Ä–æ—Å –∏ —à–ª–µ—Ç –∫—Ä–∞—Ç–∫—É—é –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Ä–∞–±–æ—á—É—é –≥—Ä—É–ø–ø—É (`TELEGRAM_NOTIFY_CHAT_ID`). –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–∞ –±–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ OpenRouter (–º–æ–¥–µ–ª—å `minimax/minimax-m2:free`).

## –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≥—Ä—É–ø–ø—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
1. –°–æ–∑–¥–∞–π—Ç–µ Telegram‚Äë–≥—Ä—É–ø–ø—É –∏–ª–∏ –∫–∞–Ω–∞–ª, –¥–æ–±–∞–≤—å—Ç–µ —Ç—É–¥–∞ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
2. –£–∑–Ω–∞–π—Ç–µ `chat_id`:
   - –≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–∑–æ–≤–∏—Ç–µ `https://api.telegram.org/bot<–¢–û–ö–ï–ù>/getUpdates`, –Ω–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ‚Äë–Ω–∏–±—É–¥—å –≤ –≥—Ä—É–ø–ø—É ‚Äî –≤ JSON —É–≤–∏–¥–∏—Ç–µ `chat":{"id":-100123...}` (–¥–ª—è –≥—Ä—É–ø–ø ID –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π);
   - –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ @RawDataBot / @getidsbot.
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –≤ `.env` ‚Üí `TELEGRAM_NOTIFY_CHAT_ID`.

## –ó–∞–ø—É—Å–∫
```bash
python telegram_bot.py
```
–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ long polling. –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä–Ω—É—Ç—å –≤ systemd/pm2/docker.

## –ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∏–∞–ª–æ–≥
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/start`, –±–æ—Ç –∑–∞–¥–∞—ë—Ç —Ç—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞: –∏–º—è ‚Üí —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí —Å—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞.
2. –ü–æ—Å–ª–µ —Ç—Ä–µ—Ç—å–µ–≥–æ —à–∞–≥–∞ –±–æ—Ç:
   - –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –∑–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞;
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É –≤ —Ä–∞–±–æ—á—É—é –≥—Ä—É–ø–ø—É (`–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ üì• ‚Ä¶`);
   - –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ OpenRouter –∫–ª—é—á–∞ –¥–∞—ë—Ç –ò–ò‚Äë–æ—Ç–≤–µ—Ç –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –≤–æ–ø—Ä–æ—Å–∞.
3. –õ—é–±—ã–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –±–æ—Ç —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ OpenRouter –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç (–∏–ª–∏ —à–∞–±–ª–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ –ò–ò –æ—Ç–∫–ª—é—á—ë–Ω).

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç
1. –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤ WhatsApp ‚Üí Meta —à–ª—ë—Ç –≤–µ–±—Ö—É–∫ –Ω–∞ `/webhook`.
2. Flask‚Äë—Å–µ—Ä–≤–∏—Å:
   - –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –≤ Telegram (—á—Ç–æ–±—ã –≤—ã –≤–∏–¥–µ–ª–∏ –∏—Å—Ç–æ—Ä–∏—é);
   - –±–µ—Ä—ë—Ç —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ OpenRouter (–º–æ–¥–µ–ª—å `minimax/minimax-m2:free`);
   - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WhatsApp Cloud API;
   - –∫–æ–ø–∏—é –æ—Ç–≤–µ—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤ Telegram.
3. –ï—Å–ª–∏ OpenRouter –∏–ª–∏ WhatsApp API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, –æ—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è, –∫–ª–∏–µ–Ω—Ç—É –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ.

–ß—Ç–æ–±—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–¥–æ–ø, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `ENABLE_AI_AUTOREPLY=false` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å ‚Äî —Ç–æ–≥–¥–∞ –±–æ—Ç –±—É–¥–µ—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram.

## Health check
`GET /healthz` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"status":"ok"}` ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞–º–∏.
